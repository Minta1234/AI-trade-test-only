# AI-trade-test-only

---

# Minta AI Trader – Forex 5m (EURUSD)

This project is a small end-to-end AI trading sandbox for **EURUSD 5-minute candles**:

* Load historical data from CSV (e.g. from **MetaTrader 5 / OANDA**)
* Build **technical indicators** (EMA, RSI, MACD, returns)
* Train a **Neural Network classifier** (MLP) to predict **next-bar direction**
* Use the trained model to:

  * Predict on new CSV data (`predict.py`)
  * Optionally feed signals into a Streamlit chart UI (real-time or backtest)

---

## 1. Project Structure

Typical layout:

```text
minta_ai_trader_full_v2/
├─ config/
│  └─ config.json              # main config (CSV path, mode, symbol, timeframe)
├─ data/
│  └─ raw/
│     └─ EURUSD_5m_sample.csv  # training data from MT5 (EURUSD M5)
├─ models/
│  ├─ ai_model.pkl             # trained MLP model (generated by train_ai.py)
│  └─ scaler.pkl               # StandardScaler used for features
├─ minta_trader/
│  ├─ __init__.py
│  ├─ data_loader.py           # CSVLoader (reads MT5 CSV correctly)
│  ├─ indicators.py            # add_indicators(): EMA, RSI, MACD, return_1
│  ├─ strategy_ai.py           # AIStrategy: wraps model to generate BUY/SELL
│  ├─ strategy_rule.py         # RuleStrategy: simple rule-based strategy
│  └─ utils.py                 # load_json, helpers
├─ train_ai.py                 # training script
├─ predict.py                  # prediction script for a CSV file
└─ (optional Streamlit app)    # e.g. realtime_chart.py / app.py
```

---

## 2. Data Format (MT5 / OANDA Export)

The AI expects **5-minute candles** in a CSV from MetaTrader 5 like:

```text
Date,Time,Open,High,Low,Close,Volume
2023.01.02,07:00,1.07016,1.07017,1.06909,1.06967,340
2023.01.02,08:00,1.06971,1.06989,1.06754,1.06935,554
...
```

In this repo, the file is:

```text
data/raw/EURUSD_5m_sample.csv
```

Important details:

* Encoding: **UTF-16** (standard MT5 export)
* Separator: **TAB**, not comma
  → the loader uses `sep="\t"` and encoding detection.
* Columns: **`Date`, `Time`, `Open`, `High`, `Low`, `Close`, `Volume`**

The loader (`CSVLoader`) converts this into a clean DataFrame:

* Combines `Date` + `Time` → `datetime` index
* Renames:

  * `Open`  → `open`
  * `High`  → `high`
  * `Low`   → `low`
  * `Close` → `close`
  * `Volume`→ `volume`
* Ensures numeric types and sorted index

---

## 3. Indicators & Features

`minta_trader/indicators.py` defines `add_indicators(df)`:

Input: DataFrame with columns:

* `open, high, low, close, volume`

It adds:

* `ema_fast`  – EMA(9) of `close`
* `ema_slow`  – EMA(21) of `close`
* `rsi`       – RSI(14) of `close`
* `macd`      – MACD main line
* `macd_signal` – MACD signal line
* `macd_hist` – MACD histogram
* `return_1`  – 1-bar return: `close.pct_change()`

Then it:

* Replaces `inf/-inf` with `NaN`
* Forward/backward fills `NaN` so features are ready for training

These are used as the **input features** for the AI model.

Feature list in `train_ai.py`:

```python
feature_cols = [
    "return_1", "ema_fast", "ema_slow", "rsi",
    "macd", "macd_signal", "macd_hist",
]
```

---

## 4. How the AI Model Works

The training target is **direction of the next candle**:

```python
future_close = df["close"].shift(-1)
y = (future_close > df["close"]).astype(int)  # 1 = UP, 0 = DOWN/FLAT
```

* Input `X` = the 7 indicator features above
* Output `y` = 0 or 1 (binary classification)

Model:

```python
from sklearn.neural_network import MLPClassifier

model = MLPClassifier(
    hidden_layer_sizes=(32, 16),
    max_iter=500
)
```

Pipeline:

1. Split time series into train/test (no shuffle):

   ```python
   X_train, X_test, y_train, y_test = train_test_split(
       X, y, test_size=0.2, shuffle=False
   )
   ```

2. Scale features with `StandardScaler`:

   ```python
   scaler = StandardScaler()
   X_train_scaled = scaler.fit_transform(X_train)
   X_test_scaled = scaler.transform(X_test)
   ```

3. Fit the model and print test accuracy:

   ```python
   model.fit(X_train_scaled, y_train)
   score = model.score(X_test_scaled, y_test)
   ```

4. Save both model and scaler:

   ```python
   joblib.dump(model, "models/ai_model.pkl")
   joblib.dump(scaler, "models/scaler.pkl")
   ```

---

## 5. Installation

```bash
git clone https://github.com/Minta1234/AI-trade-test-only.git
cd minta_ai_trader_full_v2

# (Optional but recommended) create virtualenv
python -m venv .venv
# Windows:
.venv\Scripts\activate
# Linux/Mac:
source .venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

Make sure the `data/raw/EURUSD_5m_sample.csv` exists and has the correct MT5 format.

---

## 6. Configuration (`config/config.json`)

Example:

```json
{
  "csv_path": "data/raw/EURUSD_5m_sample.csv",
  "mode": "ai",            // "ai" or "rule"
  "symbol": "EURUSD",      // for realtime chart / yfinance mapping
  "timeframe": "5m"        // timeframe info (not used in training)
}
```

* `csv_path` is used by `train_ai.py` to locate the training data.
* `mode` is used by the Streamlit app to select AI vs rule-based strategy.

---

## 7. Train the AI Model

From the project root:

```bash
python train_ai.py
```

The script:

1. Reads `config/config.json`
2. Loads CSV via `CSVLoader`
3. Adds indicators
4. Builds `X` (7 features) and `y` (next-bar direction)
5. Trains MLP
6. Prints test accuracy
7. Saves:

   ```text
   models/ai_model.pkl
   models/scaler.pkl
   ```

---

## 8. Predict on New CSV (Offline)

To generate predictions on a new CSV (same format as MT5 export):

```bash
python predict.py
```

`predict.py` does:

1. Auto-detects encoding (UTF-16) and reads CSV with `sep="\t"`.
2. Combines `Date` + `Time` → `datetime` index.
3. Renames columns to `open, high, low, close, volume`.
4. Adds the same indicators with `add_indicators`.
5. Builds `X` with the same 7 features.
6. Loads `models/ai_model.pkl` and `models/scaler.pkl`.
7. Scales X and runs `model.predict`.
8. Appends `prediction` column to the DataFrame:

   ```text
   prediction = 1 → Model expects next close to go UP
   prediction = 0 → Model expects next close to go DOWN or stay the same
   ```

At the end it prints the last few rows:

```text
open  high  low  close  volume  ema_fast ... macd_hist  return_1  prediction
```

You can modify `predict.py` to:

* Save the result to CSV
* Integrate with other systems
* Feed into backtest or live logic

---

## 9. (Optional) Streamlit Real-Time Chart

If you have a Streamlit script in this repo (e.g. a file that:

* downloads real-time EURUSD from **yfinance**
* calls `add_indicators`
* uses `AIStrategy` / `RuleStrategy`
* plots candlesticks + BUY/SELL markers with Plotly

You can run it like:

```bash
streamlit run <your_streamlit_script>.py
```

Typical behaviour:

* Read `config/config.json` (`mode`, `symbol`, `timeframe`)
* Fetch 5m candles from Yahoo (e.g. `EURUSD=X`)
* Add indicators
* For each bar, call `strategy.generate_signal(row)` from:

  * `strategy_ai.py` → use AI model
  * `strategy_rule.py` → use fixed rules
* Plot a candlestick chart with BUY/SELL markers
* Show the latest bar and last signal

---

## 10. Typical Workflow

1. **Export data from MT5** (EURUSD, M5, UTF-16, TAB-separated):

   * Save as: `data/raw/EURUSD_5m_sample.csv`

2. **Update `config/config.json`** if needed.

3. **Train AI model**:

   ```bash
   python train_ai.py
   ```

4. **Test predictions on the same or new CSV**:

   ```bash
   python predict.py
   ```

5. **Use AI in UI / live chart** (Streamlit app, if present):

   ```bash
   streamlit run streamlit_app.py
   ```

---
# EURUSD_5m_sample.csv 
*make your own

